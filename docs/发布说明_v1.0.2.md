# BookStore v1.0.2 发布说明

发布日期：2025-12-20

## 新功能

### 1. 中文支持（Chinese Support）
- **用户名**：现支持中文用户名
- **书名**：支持中文书名输入和检索
- **作者**：支持中文作者名输入
- **关键词**：支持中文关键词输入和检索
- **底层实现**：
  - 新增 `UnicodeValidator::han()` 方法
  - 新增 `is_cspecial()` 函数，支持中文标点符号（「ー」「・」等）
  - 新增 `detect_script()` 函数用于Unicode字符脚本识别

### 2. 日文支持（Japanese Support）
- **用户名**：现支持日文用户名（平假名、片假名、汉字）
- **书名**：支持日文书名输入和检索
- **作者**：支持日文作者名输入
- **关键词**：支持日文关键词输入和检索
- **底层实现**：
  - 新增 `UnicodeValidator::japanese()` 方法
  - 新增 `is_jspecial()` 函数，支持日文标点符号（「〜」「ー」「・」等）
  - 新增 `detect_script()` 函数用于Unicode字符脚本识别

### 3. 图书删除功能
- **新增"删除"按钮**：允许店长(权限{7})删除已有图书
- **权限控制**：
  - 店长{7}：可删除任意图书
  - 员工{3}：不可删除图书（按钮隐藏）
  - 顾客{1}及游客{0}：不可删除图书
- **操作流程**：
  1. 在图书表格中选择要删除的图书
  2. 点击「删除」按钮
  3. 在弹出对话框中确认ISBN并删除
- **数据清理**：删除操作会同步清理所有相关索引
  - ISBN索引
  - 书名索引
  - 作者索引
  - 关键词索引

## 改进与优化

### 1. 表单验证改进
- **可选字段支持**：书名、作者、关键词现支持留空
- **验证逻辑优化**：仅ISBN和价格为必填项
- **关键词处理**：
  - 当关键词为空时，跳过关键词格式检查
  - 当关键词非空时，进行完整的格式验证（包括去重检查）

### 2. 删除后数据恢复
- **数据清理**：删除图书时，将图书记录标记为空
- **序列化优化**：`BookManager::serialize()` 现跳过已删除的图书记录

### 3. 代码质量提升
- 新增权限{3}员工的图书管理权限细分
- 改进删除对话框的用户提示
- 完善删除流程的日志记录

## 兼容性说明

- ✅ 完全兼容 v1.0.0 及 v1.0.1 的数据格式
- ✅ 旧版创建的账户和图书数据无需迁移
- ✅ 支持平滑升级，无数据丢失风险

## 技术细节

### Unicode 字符脚本识别
新版本引入了完整的 Unicode 字符脚本识别机制：

| 脚本 | Unicode范围 | 使用场景 |
|------|----------|---------|
| ASCII | U+0000-U+007F | 英文及数字 |
| Latin | U+00C0-U+024F, U+1E00-U+1EFF | 拉丁字母变音 |
| Han | CJK统一汉字块 | 中文汉字 |
| Hiragana | U+3040-U+309F | 日文平假名 |
| Katagana | U+30A0-U+30FF | 日文片假名 |
| 其他脚本 | - | 其他语言支持 |

### 日文标点支持
新增19个日文常用标点符号的识别：
- 「〜」「ー」「・」「：」「／」「…」等

## 已知限制

- 用户ID仍仅支持数字、字母、下划线
- 密码仍仅支持数字、字母、下划线
- ISBN仅支持ASCII可见字符

## 修复内容

本版本继承了 v1.0.1 的所有Bug修复，包括：
- CSV导出的路径选择和自动补全
- 异常处理与错误提示的完善

---

## 升级建议

建议所有 v1.0.0 及 v1.0.1 的用户升级至本版本，以获得更完整的多语言支持和图书管理功能。
