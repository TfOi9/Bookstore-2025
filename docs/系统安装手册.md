# BookStore 系统安装手册

**版本**: v1.0.1  
**发布日期**: 2025年12月17日  
**适用平台**: macOS 10.13+ (Apple Silicon / Intel) 和 Windows 10+

---

## 目录

1. [系统概述](#系统概述)
2. [系统要求](#系统要求)
3. [macOS 安装指南](#macos-安装指南)
4. [Windows 安装指南](#windows-安装指南)
5. [验证安装](#验证安装)
6. [故障排查](#故障排查)
7. [卸载说明](#卸载说明)

---

## 系统概述

BookStore 是一个功能完善的书店管理系统，提供图形化界面（GUI）和命令行界面（CLI）两种操作方式。系统基于 Qt 6 框架开发，支持账户管理、图书管理、财务日志等核心功能，适用于书店的日常运营管理。

## 系统要求

### macOS 系统要求

- **操作系统**: macOS 10.13 (High Sierra) 或更高版本
- **处理器**: Apple Silicon (M1/M2/M3) 或 Intel x86_64
- **内存**: 至少 4GB RAM
- **硬盘空间**: 至少 500MB 可用空间
- **依赖组件**: Qt 6 运行时库（通过 Homebrew 安装）

### Windows 系统要求

- **操作系统**: Windows 10 或更高版本
- **处理器**: x86_64 架构
- **内存**: 至少 4GB RAM
- **硬盘空间**: 至少 500MB 可用空间
- **依赖组件**: Visual C++ Redistributable（如需要会自动提示）

---

## macOS 安装指南

### 步骤 1: 安装 Qt 运行时

BookStore macOS 版本依赖 Qt 6 框架。请按以下方式之一安装：

#### 方式一：使用自动安装脚本（推荐）

1. 打开「终端」应用程序（可在「应用程序 > 实用工具」中找到）
2. 进入 BookStore 安装包所在目录：
   ```bash
   cd /path/to/BookStore
   ```
3. 运行安装脚本：
   ```bash
   bash tools/install_qt_mac.sh
   ```
4. 等待安装完成（首次安装可能需要几分钟）

#### 方式二：手动安装 Qt 6

如果您已经安装了 Homebrew：

```bash
brew install qt@6
brew link qt@6 --force --overwrite
```

如果尚未安装 Homebrew，请先访问 https://brew.sh 按说明安装。

### 步骤 2: 安装应用程序

1. 找到 `BookStore.app` 文件
2. 将 `BookStore.app` 拖动到「应用程序」文件夹（`/Applications`）
   - 也可以放置在任何您有读取权限的目录

### 步骤 3: 首次运行

1. 在「应用程序」文件夹中找到 BookStore
2. 双击 `BookStore.app` 启动应用

**注意**: 如果出现「应用已损坏」或「无法打开」的提示，请执行以下命令：

```bash
xattr -dr com.apple.quarantine /Applications/BookStore.app
```

然后重新尝试打开应用。

### 步骤 4: 初始化

首次启动时，系统会自动：
- 创建数据存储目录：`~/Library/Application Support/BookStore/`
- 初始化数据库文件
- 创建默认管理员账户：
  - 用户名：`root`
  - 密码：`sjtu`
  - 权限：店长（最高权限）

---

## Windows 安装指南

### 步骤 1: 解压安装包

1. 下载 `BookStore_Windows.zip` 安装包
2. 右键点击压缩包，选择「解压到当前文件夹」
3. 将解压后的 `BookStore` 文件夹移动到您希望的安装位置（如 `C:\Program Files\BookStore`）

### 步骤 2: 检查依赖

BookStore Windows 版本已打包所有必要的 Qt 运行库。如果启动时提示缺少 DLL 文件，请：

1. 下载并安装 Visual C++ Redistributable：
   - [下载地址](https://aka.ms/vs/17/release/vc_redist.x64.exe)
2. 重启计算机

### 步骤 3: 创建快捷方式（可选）

1. 右键点击 `BookStore.exe`
2. 选择「发送到 > 桌面快捷方式」
3. 或选择「固定到任务栏」

### 步骤 4: 首次运行

1. 双击 `BookStore.exe` 启动应用
2. 如果出现 Windows 防火墙提示，请选择「允许访问」

### 步骤 5: 初始化

首次启动时，系统会自动：
- 在应用程序目录创建数据文件
- 初始化数据库
- 创建默认管理员账户：
  - 用户名：`root`
  - 密码：`sjtu`
  - 权限：店长（最高权限）

---

## 验证安装

### macOS 验证步骤

1. **检查 Qt 安装**：
   ```bash
   brew info qt@6
   ```
   应显示 Qt 6 已安装且已链接。

2. **检查应用依赖**：
   ```bash
   otool -L /Applications/BookStore.app/Contents/MacOS/BookStore | head
   ```
   应显示 Qt 库路径正确。

3. **检查数据目录**：
   ```bash
   ls ~/Library/Application\ Support/BookStore/
   ```
   首次运行后应看到数据文件。

4. **启动应用**：
   双击 BookStore.app，应正常显示登录界面。

### Windows 验证步骤

1. **检查应用文件**：
   确认安装目录包含：
   - `BookStore.exe`
   - Qt DLL 文件（如 `Qt6Core.dll`、`Qt6Widgets.dll` 等）
   - `platforms` 文件夹

2. **检查数据目录**：
   首次运行后，应用目录应包含数据文件（`*.dat`）

3. **启动应用**：
   双击 `BookStore.exe`，应正常显示登录界面。

### 功能测试

使用默认管理员账户登录：
- 用户名：`root`
- 密码：`sjtu`

如果能成功登录并看到主界面，说明安装成功。

---

## 故障排查

### macOS 常见问题

#### 问题 1: 提示「无法打开应用，因为它来自身份不明的开发者」

**解决方案**：
```bash
xattr -dr com.apple.quarantine /Applications/BookStore.app
```

#### 问题 2: 提示缺少 Qt 库

**现象**: 启动时提示找不到 `libQt6Core.dylib` 等

**解决方案**：
1. 重新安装 Qt：
   ```bash
   brew reinstall qt@6
   brew link qt@6 --force --overwrite
   ```
2. 如果问题持续，运行：
   ```bash
   bash tools/install_qt_mac.sh
   ```

#### 问题 3: 应用无响应或崩溃

**解决方案**：
1. 查看系统日志：
   ```bash
   log show --predicate 'process == "BookStore"' --last 5m
   ```
2. 删除数据目录重新初始化：
   ```bash
   rm -rf ~/Library/Application\ Support/BookStore/
   ```
3. 重新启动应用

#### 问题 4: Qt 版本不兼容

**现象**: 提示 Qt 版本错误

**解决方案**：
```bash
brew upgrade qt@6
```

### Windows 常见问题

#### 问题 1: 提示缺少 DLL 文件

**现象**: 启动时提示 `VCRUNTIME140.dll` 或类似文件缺失

**解决方案**：
1. 下载并安装 [Visual C++ Redistributable](https://aka.ms/vs/17/release/vc_redist.x64.exe)
2. 重启计算机
3. 重新启动应用

#### 问题 2: 应用无法启动（无任何提示）

**解决方案**：
1. 右键点击 `BookStore.exe`，选择「以管理员身份运行」
2. 检查防病毒软件是否拦截了应用
3. 将应用添加到防病毒软件的白名单

#### 问题 3: 界面显示异常或乱码

**解决方案**：
1. 确认系统区域设置为中文（简体）
2. 右键点击 `BookStore.exe` > 属性 > 兼容性
3. 勾选「以兼容模式运行这个程序」，选择 Windows 10

#### 问题 4: 数据文件损坏

**解决方案**：
1. 备份当前数据文件（位于应用目录）
2. 删除所有 `.dat` 文件
3. 重新启动应用，系统将自动重新初始化

### 通用问题

#### 问题: 忘记管理员密码

**解决方案**：
1. 完全退出应用
2. 删除数据目录中的账户数据文件（会清除所有账户）
3. 重新启动应用，使用默认账户 `root/sjtu` 登录

#### 问题: 数据导出失败

**解决方案**（v1.0.1 已修复）：
1. 确保选择的导出目录有写入权限
2. 文件名会自动补全 `.csv` 或 `.txt` 扩展名
3. 导出失败时会显示包含完整路径的错误提示

---

## 卸载说明

### macOS 卸载

1. **删除应用程序**：
   ```bash
   rm -rf /Applications/BookStore.app
   ```

2. **删除用户数据**（可选）：
   ```bash
   rm -rf ~/Library/Application\ Support/BookStore/
   ```

3. **卸载 Qt 运行时**（可选，如不需要其他 Qt 应用）：
   ```bash
   brew uninstall qt@6
   ```

### Windows 卸载

1. **删除应用程序**：
   - 删除 BookStore 安装目录

2. **删除用户数据**（可选）：
   - 删除应用目录中的所有 `.dat` 文件

3. **删除快捷方式**：
   - 删除桌面和开始菜单中的快捷方式

---

## 技术支持

如遇到安装问题，请：

1. 查阅本手册的故障排查章节
2. 检查系统是否满足最低要求
3. 联系技术支持团队

**项目主页**: https://github.com/TfOi9/BookStore  
**问题反馈**: 请在 GitHub Issues 提交

---

## 附录

### 数据文件位置

- **macOS**: `~/Library/Application Support/BookStore/`
- **Windows**: 应用程序安装目录

### 默认文件列表

初始化后将创建以下文件：
- 账户数据文件
- 图书数据文件
- 日志数据文件
- 索引文件

总文件数不超过 20 个。

### 版本历史

- **v1.0.1** (2025-12-17): 修复文件导出相关问题
- **v1.0.0** (2025-12-15): 首次正式发布

---

*本手册最后更新: 2025年12月17日*
