# BookStore 前端设计文档

项目名称：BookStore（书店管理系统）  
文档作者：TfOi9    
修订记录：2025-12-17 修订

## 概述

本文件描述 BookStore 的图形界面（GUI）前端设计与实现要点。前端基于 Qt Widgets（Qt5/Qt6 兼容），围绕“顶部导航栏 + 中部数据区（表格）+ 底部操作区（控制面板）”的三段式布局构建，面向三类用户（游客、顾客、管理员/店长）提供账户、图书与日志的可视化功能。

后端能力由 `AccountManager`、`BookManager`、`LogManager` 提供（见核心模块文档）。前端通过全局指针注入并调用这些管理器以完成业务动作。

## 技术栈与目标

- 框架：Qt Widgets（`QMainWindow`, `QWidget`, `QTableWidget`, `QDialog` 等）
- 构建：CMake（与 CLI 共用工程，目标 `BookStore`）
- 运行平台：macOS、Windows（图标与启动形态均已适配）
- 设计目标：
  - 统一导航，清晰的信息架构；
  - 明确的状态反馈（状态栏提示、禁用/启用按钮）；
  - 尽量复用后端校验与日志能力，减少前端重复逻辑；
  - 跨平台一致的视觉与交互。

## 界面布局

- 主窗口：`MainWindow`（见 [frontend/include/main_window.hpp](../frontend/include/main_window.hpp)）
  - 布局：`QVBoxLayout`
    - 顶部：`TopBar`（导航与用户区）
    - 中部：`QStackedWidget`（三类表格区：账户/图书/日志）
    - 底部：`QStackedWidget`（三类控制面板区）
  - 初始化默认页：图书表格 + 图书控制面板
  - 状态栏显示当前身份与提示


## 模块与职责

- 顶部导航：`TopBar`（见 [frontend/include/top_bar.hpp](../frontend/include/top_bar.hpp)）
  - 信号：`accountButtonClicked()`、`bookButtonClicked()`、`logButtonClicked()`、`authChanged(QString)`
  - 槽：登录、注册、注销、个人信息按钮处理
  - 行为：依据登录态动态刷新可见按钮与文案（`refreshBar()`）

- 表格区（Tables）（见 [frontend/include/tables/](../frontend/include/tables)）
  - `AccountTable`：显示/筛选账户，发出 `accountSelected` 以同步到控制面板
  - `BookTable`：显示/筛选图书，发出 `bookSelected` 以同步到控制面板
  - `LogTable`：显示系统日志，支持条件刷新
  - 统一接口：`refreshTable([force])`、`handleSearch(...)`

- 控制面板区（Panels）（见 [frontend/include/panels/](../frontend/include/panels)）
  - `AccountControlPanel`：账户相关操作（登录/注册/改密/增删等）
    - 信号：`accountListChanged`、`searchedAccounts`、`loginSucceeded`
  - `BookControlPanel`：图书相关操作（检索/选择/修改/进货/购买等）
    - 信号：`bookListChanged`、`searchedBooks`
  - `LogControlPanel`：日志查询与报表（财务/员工）
    - 信号：`refreshLogs`、`searchedLogs`

- 弹窗对话框（Dialogs）（见 [frontend/include/dialogs/](../frontend/include/dialogs)）
  - 账户：`login_dialog`、`register_dialog`、`modify_password_dialog`、`delete_account_dialog`、`profile_dialog`、`add_account_dialog`、`login_account_dialog`、`search_account_dialog`
  - 图书：`add_book_dialog`、`modify_book_dialog`、`import_dialog`、`buy_dialog`、`export_csv_dialog`、`search_book_dialog`
  - 日志：`report_finance_dialog`、`report_employee_dialog`、`finance_query_dialog`、`search_log_dialog`

## 交互与事件流

- 顶部切换：
  - `TopBar` 发出 `accountButtonClicked/bookButtonClicked/logButtonClicked`；
  - `MainWindow` 切换中部与底部的 `QStackedWidget` 到对应视图，并调用 `refreshTable/refreshPanel`；
- 选择联动：
  - 表格选择项变化 → 发出 `accountSelected/bookSelected` → 控制面板接收并更新当前操作上下文；
- 搜索联动：
  - 控制面板触发 `searched*` 信号携带过滤条件 → 表格 `handleSearch` 应用过滤并 `refreshTable`；
- 身份变更：
  - 登录成功触发 `loginSucceeded` → 顶栏 `refreshBar()`，并通过 `authChanged` 推送状态消息 → `MainWindow` 重设当前页到图书视图并刷新。

上述连接关系与刷新逻辑在 `MainWindow` 构造器中集中设置（参考 [frontend/include/main_window.hpp](../frontend/include/main_window.hpp) 内多处 `connect(...)`）。

## 状态与权限

- 全局依赖：见 [frontend/include/globals.hpp](../frontend/include/globals.hpp)
  - `AccountManager* account_manager`、`BookManager* book_manager`、`LogManager* log_manager`
- 权限语义与 CLI 保持一致：0（游客）、1（顾客）、3（管理员/员工）、7（店长）
-顶栏与控制面板会据此启用/禁用对应操作；对话框在提交前做基本校验并依赖后端进行最终校验与执行业务。

## 视图与样式

- 样式基于 Qt 默认控件，`TopBar::applyStyle()` 统一设置导航区的尺寸、间距与视觉；
- 主窗体：默认尺寸 800×600，标题 `BookStore`；
- 状态栏：展示当前身份与操作反馈（如“游客模式”“已登录: <userId>”）。

## 图标与平台适配

- macOS：
  - Info.plist：`CFBundleIconFile = BookShelf`（不含扩展名）；
  - 图标包：`BookShelf.icns` 内含多尺寸、带 Alpha 的 PNG；
  - 运行时：`app.setWindowIcon("../Resources/BookShelf.icns")`；
- Windows：
  - 可执行图标：RC 资源内嵌 `.ico`；
  - 运行时窗口图标：Qt 资源 `:/icons/BookShelf.ico` 设置，确保窗口与任务栏一致；

## 构建与运行

- 目标：
  - macOS：`BookStore.app`（`Contents/Resources/BookShelf.icns`）
  - Windows：`BookStore.exe`（内嵌 `.ico`，无控制台窗口）
- 依赖：Qt Widgets；CMake 自动检测 Qt5/Qt6

## 目录与关键文件

- 主窗口与导航：
  - [frontend/include/main_window.hpp](../frontend/include/main_window.hpp)
  - [frontend/include/top_bar.hpp](../frontend/include/top_bar.hpp)
- 表格与面板：
  - [frontend/include/tables/](../frontend/include/tables)
  - [frontend/include/panels/](../frontend/include/panels)
- 对话框：
  - [frontend/include/dialogs/](../frontend/include/dialogs)
- 公共与全局：
  - [frontend/include/qt_common.hpp](../frontend/include/qt_common.hpp)
  - [frontend/include/globals.hpp](../frontend/include/globals.hpp)
- 图标与资源：
  - [frontend/icons/](../frontend/icons)
  - [frontend/icons/icons.qrc](../frontend/icons/icons.qrc)
- 构建：
  - [CMakeLists.txt](../CMakeLists.txt)
  - [frontend/Info.plist.in](../frontend/Info.plist.in)

## 错误处理与提示

- 前端在表单提交前做基础校验（空值、长度等），错误通过 `QMessageBox` 或状态栏反馈；
- 业务与权限错误由后端返回并提示用户；